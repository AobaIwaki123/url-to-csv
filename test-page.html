<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Net2Sheet テストページ</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .header {
        text-align: center;
        margin-bottom: 40px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }
      .card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }
      .card-content {
        padding: 15px;
      }
      .load-more {
        text-align: center;
        margin: 40px 0;
      }
      .load-more button {
        background: #007bff;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .load-more button:hover {
        background: #0056b3;
      }
      .instructions {
        background: #e7f3ff;
        border: 1px solid #bee5eb;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
      }
      .instructions h3 {
        color: #004085;
        margin-top: 0;
      }
      .dynamic-content {
        margin-top: 30px;
        padding: 20px;
        background: white;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>🔍 Net2Sheet テストページ</h1>
      <p>
        Chrome拡張機能のネットワーク監視をテストするためのサンプルページです
      </p>
    </div>

    <div class="instructions">
      <h3>📋 テスト手順</h3>
      <ol>
        <li>F12キーでDevToolsを開く</li>
        <li>「Net2Sheet」タブをクリック</li>
        <li>「収集開始」ボタンを押す</li>
        <li>
          このページを再読み込み（F5）または「画像を追加読み込み」ボタンをクリック
        </li>
        <li>DevToolsで収集された画像データを確認</li>
        <li>「CSVダウンロード」でファイル出力をテスト</li>
      </ol>
    </div>

    <!-- 静的な画像（様々な形式） -->
    <div class="gallery" id="staticGallery">
      <div class="card">
        <img src="https://picsum.photos/400/300?random=1" alt="ランダム画像1" />
        <div class="card-content">
          <h3>JPEG画像サンプル</h3>
          <p>ランダムな風景画像（JPEG形式）</p>
        </div>
      </div>

      <div class="card">
        <img src="https://picsum.photos/400/300.png?random=10" alt="PNG画像" />
        <div class="card-content">
          <h3>PNG画像サンプル</h3>
          <p>ランダム画像（PNG形式）</p>
        </div>
      </div>

      <div class="card">
        <img src="https://picsum.photos/400/300?random=2" alt="ランダム画像2" />
        <div class="card-content">
          <h3>WebP対応画像</h3>
          <p>高圧縮画像形式のテスト</p>
        </div>
      </div>

      <div class="card">
        <img
          src="https://picsum.photos/400/300.jpg?random=11"
          alt="JPEG画像2"
        />
        <div class="card-content">
          <h3>JPEG画像サンプル2</h3>
          <p>別のランダム風景画像</p>
        </div>
      </div>
    </div>

    <!-- 動的に画像を追加するボタン -->
    <div class="load-more">
      <button onclick="loadMoreImages()">🖼️ 画像を追加読み込み</button>
      <button onclick="loadDifferentSources()">
        🌍 異なるソースの画像を読み込み
      </button>
    </div>

    <!-- 動的コンテンツエリア -->
    <div class="dynamic-content">
      <h3>動的に追加された画像</h3>
      <div class="gallery" id="dynamicGallery">
        <!-- JavaScriptで画像が動的に追加される -->
      </div>
    </div>

    <!-- 様々な画像形式のテスト -->
    <div style="text-align: center; margin: 40px 0">
      <h3>様々な画像形式のテスト</h3>
      <div
        style="
          display: flex;
          justify-content: center;
          gap: 20px;
          flex-wrap: wrap;
        "
      >
        <div style="text-align: center">
          <img
            src="https://httpbin.org/image/png"
            alt="HTTPBin PNG"
            style="
              width: 80px;
              height: 80px;
              object-fit: cover;
              border-radius: 8px;
            "
          />
          <p>PNG (HTTPBin)</p>
        </div>
        <div style="text-align: center">
          <img
            src="https://httpbin.org/image/jpeg"
            alt="HTTPBin JPEG"
            style="
              width: 80px;
              height: 80px;
              object-fit: cover;
              border-radius: 8px;
            "
          />
          <p>JPEG (HTTPBin)</p>
        </div>
        <div style="text-align: center">
          <img
            src="https://jsonplaceholder.typicode.com/photos/1/thumbnailUrl"
            alt="JSONPlaceholder Thumbnail"
            style="
              width: 80px;
              height: 80px;
              object-fit: cover;
              border-radius: 8px;
            "
            onerror="this.src='https://picsum.photos/150/150.jpg?random=99'"
          />
          <p>API Thumbnail</p>
        </div>
        <div style="text-align: center">
          <img
            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjNEY0NkU1Ii8+CjxwYXRoIGQ9Ik0yNCAzMkwyNCA0OEw1NiA0MEwyNCAzMloiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo="
            alt="SVG Data URL"
            style="width: 80px; height: 80px; border-radius: 8px"
          />
          <p>SVG (Data URL)</p>
        </div>
      </div>
    </div>

    <script>
      let imageCounter = 10;

      // 追加の画像を読み込む関数
      function loadMoreImages() {
        const gallery = document.getElementById("dynamicGallery");

        // より安定した画像ソースを使用
        const imageSources = [
          `https://picsum.photos/400/300.jpg?random=${imageCounter}`,
          `https://picsum.photos/400/300.png?random=${imageCounter + 1}`,
          `https://httpbin.org/image/jpeg`,
          `https://httpbin.org/image/png`,
          `https://picsum.photos/400/300.webp?random=${imageCounter + 2}`,
          `https://jsonplaceholder.typicode.com/photos/${
            (imageCounter % 100) + 1
          }/url`,
        ];

        imageSources.forEach((src, i) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
                     <img src="${src}" 
                          alt="動的画像${imageCounter + i}" 
                          loading="lazy"
                          onerror="this.src='https://picsum.photos/400/300.jpg?random=${
                            imageCounter + i + 1000
                          }'">
                     <div class="card-content">
                         <h3>動的画像 #${imageCounter + i}</h3>
                         <p>JavaScriptで追加（フォールバック付き）</p>
                     </div>
                 `;
          gallery.appendChild(card);
        });

        imageCounter += 6;
      }

      // 異なるソースの画像を読み込む関数
      function loadDifferentSources() {
        const gallery = document.getElementById("dynamicGallery");

        const sources = [
          {
            url: `https://picsum.photos/400/300.webp?random=${imageCounter}`,
            type: "WebP",
          },
          {
            url: `https://picsum.photos/400/300.png?random=${imageCounter + 1}`,
            type: "PNG",
          },
          {
            url: `https://picsum.photos/400/300.jpg?random=${imageCounter + 2}`,
            type: "JPEG",
          },
          {
            url: `https://httpbin.org/image/jpeg?${imageCounter + 3}`,
            type: "HTTPBin JPEG",
          },
        ];

        sources.forEach((source, index) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
                    <img src="${source.url}" alt="ソース画像${
            imageCounter + index
          }" loading="lazy">
                    <div class="card-content">
                        <h3>${source.type}画像 #${imageCounter + index}</h3>
                        <p>形式: ${source.type}</p>
                    </div>
                `;
          gallery.appendChild(card);
        });

        imageCounter += 4;
      }

      // ページ読み込み時に最初の動的画像を追加
      window.addEventListener("load", () => {
        setTimeout(() => {
          loadMoreImages();
        }, 1000);
      });

      // スクロール時の遅延読み込みデモ
      let scrollTimeout;
      window.addEventListener("scroll", () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          if (
            window.innerHeight + window.scrollY >=
            document.body.offsetHeight - 1000
          ) {
            // ページ下部に近づいたら自動で画像を追加（デモ用）
            if (Math.random() > 0.7) {
              loadMoreImages();
            }
          }
        }, 200);
      });

      // テスト結果の表示
      function showTestResults() {
        const resultsDiv = document.createElement("div");
        resultsDiv.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px; border-radius: 10px; z-index: 1000;">
                    <h4>🎉 テスト完了！</h4>
                    <p>Net2Sheetで収集された画像データをDevToolsで確認してください</p>
                    <button onclick="this.parentElement.remove()" style="background: white; color: #28a745; border: none; padding: 5px 10px; border-radius: 5px; margin-top: 10px;">閉じる</button>
                </div>
            `;
        document.body.appendChild(resultsDiv);
      }

      // 5秒後にテスト完了メッセージを表示
      setTimeout(showTestResults, 5000);

      // ネットワークエラーの場合のフォールバック画像を生成
      function createFallbackImage(
        width = 400,
        height = 300,
        text = "Fallback"
      ) {
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");

        // グラデーション背景
        const gradient = ctx.createLinearGradient(0, 0, width, height);
        gradient.addColorStop(0, "#4F46E5");
        gradient.addColorStop(1, "#06B6D4");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, width, height);

        // テキスト描画
        ctx.fillStyle = "white";
        ctx.font = `${Math.max(16, width / 20)}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(text, width / 2, height / 2);

        return canvas.toDataURL("image/png");
      }

      // 全ての画像にエラーハンドリングを追加
      document.addEventListener("DOMContentLoaded", () => {
        const images = document.querySelectorAll("img");
        images.forEach((img, index) => {
          img.addEventListener("error", function () {
            if (!this.dataset.fallbackUsed) {
              this.src = createFallbackImage(400, 300, `Fallback ${index + 1}`);
              this.dataset.fallbackUsed = "true";
              console.log(
                `画像の読み込みに失敗しました: ${this.alt || "Unknown"}`
              );
            }
          });
        });
      });
    </script>
  </body>
</html>
